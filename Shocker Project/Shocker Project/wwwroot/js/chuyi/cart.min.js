$(function(){function i(){t.forEach(n=>{const t=r(n);$("#productRow").append(t)})}function r(n){return`
        <div class="col-md-4">
            <div class="card mb-3">
                <img src="${n.img}" class="card-img-top">
                <form data-pid="${n.id}" class="add-item-form card-body">
                    <h5 class="card-title">
                        ${n.title}
                    </h5>
                    <p class="card-text">
                        商品價格: $${n.price}
                    </p>
                    <div class="form-group">
                        <label>購買數量</label>
                        <input id="amountInput${n.id}" class="form-control" type="number" min="1" max="20" required>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" type="submit">
                            <i class="fas fa-cart-plus"></i> 
                            加入購物車
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `}function u(){this.key="example-cart";this.itemList=[];this.initCart=function(){const t=localStorage.getItem(this.key),n=JSON.parse(t);console.log("[defaultList]",n);this.itemList=n||[];this.render()};this.addItem=function(n,i){console.log(n,i);const r=t.find(t=>t.id==n);console.log("[商品詳情]",r);const u={...r,amount:i,createdAt:(new Date).getTime()};console.log("購物車品項",u);this.itemList.push(u);this.render()};this.deleteItem=function(n){this.itemList.splice(n,1);this.render()};this.emptyCart=function(){this.itemList=[];this.render()};this.updateDataToStorage=function(){const n=JSON.stringify(this.itemList);localStorage.setItem(this.key,n)};this.render=function(){this.updateDataToStorage();const n=$("#cartTableBody"),i=$("#cartTableFoot");n.empty();let t=0;this.itemList.forEach((i,r)=>{const u=i.price*i.amount;t+=u;const f=moment(i.createdAt).format("YYYY/MM/DD HH:mm:ss"),e=`<tr>
                <td>
                    <div class="d-flex">
                        <button data-index="${r}" class="delete-btn btn btn-danger btn-sm ">
                          &times; 
                        </button>  
                        <div>
                            <p class="m-0">${i.title}</p>
                            <p class="m-0">${f}</p>
                        </div>    
                    </div>
                </td>
                <td class="text-right">$ ${i.price}</td> 
                <td class="text-right"> ${i.amount}</td> 
                <td class="text-right">$ ${u}</td>  
            <tr>`;n.append(e)});$("#cartNumber").text(this.itemList.length);i.html(`<tr>
                        <th>總金額</th>
                        <td colspan="3" class="text-right">$ ${t}</td>
                    </tr>`)}}const t=[{id:"1",title:"產品一",price:10,img:"https://picsum.photos/id/999/1200/600",tags:["生活用品","工具"]},{id:"2",title:"產品二",price:60,img:"https://picsum.photos/id/1070/1200/600",tags:["藥妝"]},{id:"3",title:"產品三",price:180,img:"https://picsum.photos/id/1071/1200/600",tags:["食品","飲料"]},{id:"4",title:"產品四",price:220,img:"https://picsum.photos/id/1072/1200/600",tags:["生活用品","文具"]},{id:"5",title:"產品五",price:360,img:"https://picsum.photos/id/1073/1200/600",tags:["工具"]},{id:"6",title:"產品六",price:360,img:"https://picsum.photos/id/1074/1200/600",tags:["食品"]},{id:"7",title:"產品七",price:400,img:"https://picsum.photos/id/1075/1200/600",tags:["生活用品","工具"]},{id:"8",title:"產品八",price:450,img:"https://picsum.photos/id/1076/1200/600",tags:["生活用品","工具"]},{id:"9",title:"產品九",price:520,img:"https://picsum.photos/id/1077/1200/600",tags:["藥妝","保養"]}];i();const n=new u;n.initCart();console.log("購物車",n);$(".add-item-form").submit(function(t){t.preventDefault();const u=this,r=u.dataset.pid;let i=$(`#amountInput${r}`).val();i=parseInt(i);n.addItem(r,i)});$("#clearCartBtn").click(function(){console.log("[準備清空購物車]");n.emptyCart()});$("#cartTableBody").delegate(".delete-btn","click",function(){console.log("要移除的按鈕",this);const t=parseInt($(this).attr("data-index"));console.log("index",t);n.deleteItem(t)})});